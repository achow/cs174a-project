<html>
    <head>
        <script type="text/javascript">JSCLASS_PATH = 'min'</script>
        <script type="text/javascript" src="underscore/underscore.js"></script>
        <script type="text/javascript" src="min/core.js"></script>

        <script type="text/javascript" src="gl-matrix/common.js"></script>
        <script type="text/javascript" src="gl-matrix/mat4.js"></script>
        <script type="text/javascript" src="gl-matrix/mat3.js"></script>

        <script type="text/javascript" src="gl-matrix/vec4.js"></script>
        <script type="text/javascript" src="gl-matrix/vec3.js"></script>
        <script type="text/javascript" src="gl-matrix/vec2.js"></script>

        <script type="text/javascript" src="model.js"></script>

        <script type="text/javascript" src="position.js"></script>
        <script type="text/javascript" src="object.js"></script>
        <script type="text/javascript" src="actor.js"></script>
        <script type="text/javascript" src="block.js"></script>
        <script type="text/javascript" src="camera.js"></script>

        <script type="text/javascript" src="world.js"></script>
        <script type="text/javascript" src="pacman.js"></script>
        <script type="text/javascript" src="monster.js"></script>
        <script type="text/javascript" src="map.data.js"></script>

		<script id="shader-fs" type="x-shader/x-fragment">
		  #ifdef GL_ES
		  precision highp float;
		  #endif

		  void main(void) {
			  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
		  }
		</script>

		<script id="shader-vs" type="x-shader/x-vertex">
		  attribute vec4 vPosition;
		  void main(void) {
			gl_Position = vPosition;
		  }
		</script>

		<script type="text/javascript">
			/*var myWorld = new World(1);
			var myPacman = new Pacman(1, myWorld);
			myWorld.add(myPacman);*/
		
		  var myWorld;
		  var myPacman;
		  //var gl;
		  function initGL(canvas) {
			try {
			  myWorld.gl = canvas.getContext("experimental-webgl");
			  myWorld.gl.viewportWidth = canvas.width;
			  myWorld.gl.viewportHeight = canvas.height;
			} catch(e) {
			}
			if (!myWorld.gl) {
			  alert("Could not initialise WebGL, sorry :-(");
			}
		  }

		  function initShaders() {
				var fragmentShader = myWorld.getShader(myWorld.gl, myWorld.fShaderScript);
				var vertexShader = myWorld.getShader(myWorld.gl, myWorld.vShaderScript);

				myWorld.shaderProgram = myWorld.gl.createProgram();
				myWorld.gl.attachShader(myWorld.shaderProgram, fragmentShader);
				myWorld.gl.attachShader(myWorld.shaderProgram, vertexShader);
				myWorld.gl.linkProgram(myWorld.shaderProgram);

				if (!myWorld.gl.getProgramParameter(myWorld.shaderProgram, myWorld.gl.LINK_STATUS)) {
					alert("Could not initialise shaders");
				}

				myWorld.gl.useProgram(myWorld.shaderProgram);
				
				myWorld.aVertexPosition = myWorld.gl.getAttribLocation(myWorld.gl.shaderProgram, "vPosition");
				//alert(this.aVertexPosition);
				myWorld.gl.enableVertexAttribArray(myWorld.aVertexPosition);
		  }
  
		  function webGLStart() {
		  
			var canvas = document.getElementById("game-canvas");
			myWorld = new World(1);
			
			initGL(canvas);
			
			myWorld.fShaderScript = document.getElementById("shader-fs");			
			myWorld.vShaderScript = document.getElementById("shader-vs");
			initShaders();
			//initBuffers();

			myPacman = new Pacman(1, myWorld);

			myWorld.add(myPacman);
			
			myWorld.gl.clearColor(0.0, 0.0, 0.0, 1.0);

			myWorld.renderScene();
			
			//setInterval(drawScene, 15);
		  }

		</script>
    </head>
	
	<body onload="webGLStart();">
		<canvas id="game-canvas" style="border: none;" width="425" height="330"></canvas>
    </body>
	
</html>

