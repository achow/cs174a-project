<html>
    <head>
        <script type="text/javascript">JSCLASS_PATH = 'min'</script>
        <script type="text/javascript" src="underscore/underscore.js"></script>
        <script type="text/javascript" src="min/core.js"></script>

        <script type="text/javascript" src="gl-matrix/common.js"></script>
        <script type="text/javascript" src="gl-matrix/mat4.js"></script>
        <script type="text/javascript" src="gl-matrix/mat3.js"></script>

        <script type="text/javascript" src="gl-matrix/vec4.js"></script>
        <script type="text/javascript" src="gl-matrix/vec3.js"></script>
        <script type="text/javascript" src="gl-matrix/vec2.js"></script>

        <script type="text/javascript" src="map.data.js"></script>
        <script type="text/javascript" src="model.js"></script>

        <script type="text/javascript" src="position.js"></script>
        <script type="text/javascript" src="object.js"></script>
        <script type="text/javascript" src="actor.js"></script>
        <script type="text/javascript" src="block.js"></script>
        <script type="text/javascript" src="camera.js"></script>

        <script type="text/javascript" src="monster.js"></script>
        <script type="text/javascript" src="pacman.js"></script>
        <script type="text/javascript" src="world.js"></script>

        <script>
            console.log("Begin tests");
            /*var p = new Pacman(1, 1, 2);
            console.log(p.where());
            p.setDirection(DIRECTION.UP);
            p.move();
            console.log(p.where());*/

            var w = new World(1);
            w.pacman.setPosition(1, 2);
            console.log(w.pacman.where());
            w.pacman.setDirection(DIRECTION.UP);
            w.pacman.move();
            console.log(w.pacman.where());

            console.log("End tests");
        </script>

        <!-- fragment shader-->
        <script id="shader-fs" type="x-shader/x-fragment">
            precision mediump float;

            void main(void) {
                gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);
            }
        </script>

        <!-- vertex shader-->
        <script id="shader-vs" type="x-shader/x-vertex">


            void main(void) {
                gl_Position = vec4(1.0, 1.0, 1.0, 1.0);
            }
        </script>


        <script type="text/javascript">

        var gl;
        function initGL(canvas) {
            try {
                gl = canvas.getContext("experimental-webgl");
                gl.viewportWidth = canvas.width;
                gl.viewportHeight = canvas.height;
            } catch (e) {
            }
            if (!gl) {
                alert("Could not initialise WebGL, sorry :-(");
            }
        }


        function getShader(gl, id) {
            var shaderScript = document.getElementById(id);
            if (!shaderScript) {
                return null;
            }

            var str = "";
            var k = shaderScript.firstChild;
            while (k) {
                if (k.nodeType == 3) {
                    str += k.textContent;
                }
                k = k.nextSibling;
            }

            var shader;
            if (shaderScript.type == "x-shader/x-fragment") {
                shader = gl.createShader(gl.FRAGMENT_SHADER);
            } else if (shaderScript.type == "x-shader/x-vertex") {
                shader = gl.createShader(gl.VERTEX_SHADER);
            } else {
                return null;
            }

            gl.shaderSource(shader, str);
            gl.compileShader(shader);

            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                alert(gl.getShaderInfoLog(shader));
                return null;
            }

            return shader;
        }


        var shaderProgram;

        function initShaders() {
            var fragmentShader = getShader(gl, "shader-fs");
            var vertexShader = getShader(gl, "shader-vs");

            shaderProgram = gl.createProgram();
            gl.attachShader(shaderProgram, vertexShader);
            gl.attachShader(shaderProgram, fragmentShader);
            gl.linkProgram(shaderProgram);

            if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
                alert("Could not initialise shaders");
            }

            gl.useProgram(shaderProgram);

        }

        function initBuffers() {
            // load model here
        }


        function drawScene() {
            gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);
            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
        }



        function webGLStart() {
            var canvas = document.getElementById("game-canvas");
            initGL(canvas);
            initShaders();
            initBuffers();

            gl.clearColor(0.0, 0.0, 0.0, 1.0);
            gl.enable(gl.DEPTH_TEST);

            drawScene();
        }


        </script>
    </head>

    <body onload="webGLStart();">
        <canvas id="game-canvas" style="border: none;" width="500" height="500"></canvas>
    </body>

</html>

